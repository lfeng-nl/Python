# Python 魔术方法

## 1.特殊属性

- `__dict__`: 存储赋予对象的用户属性.

### 2.函数对象的特殊属性

- `__annotations__`: 参数和返回值的注解.
- `__code__`: 编译成字节码的函数元数据和函数定义体.
- `__name__`: 函数名称.
- `__defaults__`: 形参默认值.
- `__kwdefaults__`: **仅限关键字参数**的默认值.

## 2.特殊方法(魔术方法)

> 类中有很多类似`__xxx__`之类的函数，可以作为钩子，实现特殊的功能, 称为魔术方法；[参考](https://docs.python.org/zh-cn/3/reference/datamodel.html#basic-customization)

- 基础
  - `__init__(self,...)`：构造函数，对象被创建时调用；
  - `__new__(cls, ...)`: 用于创建实例并返回, 在`__init__`前被调用, 重写时需要显示调用并返回父类`__new__()`方法;
  - `__del__(self)`：在对象被销毁时调用；
  - `__str__(self)`：返回一个字符串，在实例化对象被`print()`或`str()`调用时调用；
  - `__repr__(self)`: 返回一个字符串, 在`repr()`中调用,**交互式终端中用于提示** , `__str__`不存在时替代`__str__`功能;
  - `__call__()`: 可调用;
- 运算符重载
  - `__getitem__(self, key)` ：使用`x[key]`索引操作符的时候调用;
  - `__setitem__(self, key, value)`：使用`x[key]`索引赋值;
  - `__call__` ：实例化对象本身可以做为一个方法，直接对实例进行调用；
  - `__add__(self, other)`：重载运算符`+`；此外还有`__radd__, __iadd__`
  - `__lt__(), __le__(), __eq__(), __ne__(), __gt__(), __ge__()...`
- 迭代器
  - `__iter__(self)` ：如果一个类想被用于`for...in`循环，就必须实现一个`__iter__()`方法；该方法返回一个迭代对象，然后，Python 的`for`循环就会不断调用该迭代对象的`__next__()` 方法拿到循环的下一个值；
    - 可迭代对象就是含有`__iter__()`方法的对象;
  - `__next__`: 返回容器下一个元素;
- 字符串
  - `__repr__`: 使用`repr`获取对象的字符串形式时, 会调用`__repr__`方法, 例如终端里打印一个对象;
  - `__str__`: 使用`str()`函数时被调用, 当`__str__`未实现时, 会调用`__repr__`方法;
- 数值转换
  - `__abs__, __bool__, ...`
- 属性访问控制
  - `__slots__`: 显式声明数据成员；
  - `__getattr__(self, name)`: 定义当用户试图获取一个不存在的属性的行为;
  - `__getattribute__(self, name)`: 属性访问拦截器, 访问类的属性时控制被访问时的行为, **注意避免循环调用**;
  - `__setattr__(self, name, value)`: 定义属性被赋值时的行为;
  - `__dict__`: 对象的属性字典;
  - `__dir__()`: 在`dir()`被调用时调用
    - `dir()`:返回包含属性的列表, 如果对象提供`__dir__()`方法，直接使用， 除此使用`dir()`逻辑, 包含实例的属性，类的属性和递归基类的属性;
- 上下文管理器
  - `__enter__(self)`进入上下文管理器调用;
  - `__exit__(self, exc_type, exc_value, trace)`退出上下文管理器调用;
    - `exc_type, exc_value, trace`: 可用于异常处理；
- 其他
  - `__module__`: 当前对象的类型所在模块;
  - `__class__`: 当前对象的类;
  - `__hash__`：应该同`__eq__()`一同定义， 表示可哈希；
  - `__bases__`: 由基类所组成的元组;
